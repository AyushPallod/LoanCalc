<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loan Calculator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
      }
      input, button {
        padding: 8px;
        margin: 4px 0;
      }
      button {
        cursor: pointer;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th, td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
      }
      th {
        background: #f2f2f2;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@3.6.0/dist/date-fns.min.js"></script>

    <script>
      const { useState } = React;
      const { addDays, differenceInDays, format } = dateFns;

      function LoanCalculator() {
        const [principal, setPrincipal] = useState('');
        const [rate, setRate] = useState('');
        const [openDate, setOpenDate] = useState('');
        const [closeDate, setCloseDate] = useState('');
        const [deposits, setDeposits] = useState([]);
        const [results, setResults] = useState([]);

        function handleDepositAdd() {
          setDeposits([...deposits, { date: '', amount: '' }]);
        }

        function handleDepositChange(i, field, val) {
          const arr = [...deposits];
          arr[i][field] = val;
          setDeposits(arr);
        }

        function calculate() {
          if (!principal || !rate || !openDate) return;
          let start = new Date(openDate);
          let end = closeDate ? new Date(closeDate) : new Date();
          const totalDays = differenceInDays(end, start);
          const intervals = Math.floor(totalDays / 30);
          let p = parseFloat(principal);
          const r = parseFloat(rate) / 100 / 365;
          const rows = [];

          for (let i = 0; i < intervals; i++) {
            const monthStart = addDays(start, i * 30);
            const monthEnd = addDays(start, (i + 1) * 30);
            const monthDeposits = deposits.filter(dep => dep.date && new Date(dep.date) > monthStart && new Date(dep.date) <= monthEnd);

            if (monthDeposits.length === 0) {
              const interest = p * r * 30;
              p += interest;
              rows.push({ date: format(monthEnd, "yyyy-MM-dd"), interest: interest.toFixed(2), total: p.toFixed(2) });
            } else {
              let currentPrincipal = p;
              let lastDate = monthStart;

              monthDeposits.forEach(dep => {
                const depDate = new Date(dep.date);
                // Remove any interest before deposit (since deposit clears part of loan)
                currentPrincipal -= parseFloat(dep.amount || 0);
                rows.push({
                  date: format(depDate, "yyyy-MM-dd"),
                  interest: "0.00",
                  total: currentPrincipal.toFixed(2)
                });
                lastDate = depDate;
              });

              const daysAfter = differenceInDays(monthEnd, lastDate);
              const interestAfter = currentPrincipal * r * daysAfter;
              currentPrincipal += interestAfter;
              rows.push({
                date: format(monthEnd, "yyyy-MM-dd"),
                interest: interestAfter.toFixed(2),
                total: currentPrincipal.toFixed(2)
              });
              p = currentPrincipal;
            }
          }

          const lastInterestDate = addDays(start, intervals * 30);
          const remainingDays = differenceInDays(end, lastInterestDate);
          if (remainingDays > 0) {
            const interest = p * r * remainingDays;
            p += interest;
            rows.push({ date: format(end, "yyyy-MM-dd"), interest: interest.toFixed(2), total: p.toFixed(2) });
          }

          setResults(rows);
        }

        return React.createElement(
          "div",
          null,
          React.createElement("h2", null, "Loan Calculator"),
          React.createElement("div", null,
            React.createElement("input", { placeholder: "Principal Amount", type: "number", value: principal, onChange: e => setPrincipal(e.target.value) }),
            React.createElement("input", { placeholder: "Rate of Interest (annual %)", type: "number", value: rate, onChange: e => setRate(e.target.value) }),
            React.createElement("input", { placeholder: "Opening Date", type: "date", value: openDate, onChange: e => setOpenDate(e.target.value) }),
            React.createElement("input", { placeholder: "Closing Date (optional)", type: "date", value: closeDate, onChange: e => setCloseDate(e.target.value) })
          ),
          React.createElement("h4", null, "Deposits"),
          deposits.map((dep, i) =>
            React.createElement("div", { key: i },
              React.createElement("input", { type: "date", value: dep.date, onChange: e => handleDepositChange(i, 'date', e.target.value) }),
              React.createElement("input", { type: "number", placeholder: "Amount", value: dep.amount, onChange: e => handleDepositChange(i, 'amount', e.target.value) })
            )
          ),
          React.createElement("button", { onClick: handleDepositAdd }, "Add Deposit"),
          React.createElement("br", null),
          React.createElement("button", { onClick: calculate, style: { width: "100%", background: "black", color: "white" } }, "Calculate"),
          results.length > 0 && React.createElement(
            "table", null,
            React.createElement("thead", null,
              React.createElement("tr", null,
                React.createElement("th", null, "Date"),
                React.createElement("th", null, "Interest"),
                React.createElement("th", null, "Total Amount")
              )
            ),
            React.createElement("tbody", null,
              results.map((r, i) =>
                React.createElement("tr", { key: i },
                  React.createElement("td", null, r.date),
                  React.createElement("td", null, r.interest),
                  React.createElement("td", null, r.total)
                )
              )
            )
          )
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(LoanCalculator));
    </script>
  </body>
</html>
